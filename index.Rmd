---
title: "Svensk statistik - demokrati"
author: "av William Lind"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    navbar:
      - { title: "Till startsidan", href: "https://lindw3.github.io/svenskstatistik/", align: right }
    vertical_layout: fill
    theme: journal
    css: styles.css
editor_options:
  markdown:
    wrap: 72
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(stringr)
library(scales)
library(dplyr)
library(tidyr)
library(DT)
library(png)
library(data.table)
library(magrittr)
library(gridExtra)
library(openxlsx)
library(forcats)
library(patchwork)
library(ggthemes)
library(plotly)
library(ggridges)
library(forecast)
library(GGally)
library(cluster)
library(sf)
library(ggrepel)
library(ggtext)
library(readxl)
library(waffle)

# Karta
data <- st_read("C:\\Users\\WILIDF17\\OneDrive - Sveriges Riksidrottsförbund\\Dokument\\GitHub\\svenskstatistik-demokrati\\data\\RegSO_2018_v2.gpkg" , layer = "RegSO_2018_v2")
kommuner_karta <- data %>%
  select(regso, kommunnamn, geom)
colnames(kommuner_karta) <- c("RegSO" , "Kommun" , "geom")
rm(data)


### Dataprep

# Valdeltagande riksdagsval
valdeltagande <- read_excel("data/valdeltagande.xlsx")

# Valresultat i riksdagsval
valresultat_sverige <- read_excel("data/valresultat_sverige.xlsx", 
                                         col_types = c("text", "numeric", "numeric", 
                                                       "numeric", "numeric", "numeric", 
                                                       "numeric", "numeric", "numeric", 
                                                       "numeric"))

# Valresultat i EU-val
valresultat_eu <- read_excel("data/valresultat_eu.xlsx", 
     col_types = c("text", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric"))

# Valresultat i kommunval
valresultat_kommun <- read_excel("data/valresultat_kommun.xlsx", 
     col_types = c("text", "text", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric"))
valresultat_kommun <- valresultat_kommun %>% 
  pivot_longer(!c(Kommun, Parti) , names_to = "År" , values_to = "Andel") %>%
  filter(!(Parti %in% c("ogiltiga valsedlar" , "ej röstande"))) %>% 
  mutate(Färg = ifelse(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna"), "Blå", "Röd")) %>% 
  mutate(Kommun = substr(Kommun, 6, nchar(Kommun)))

   # Dela upp i röd och blå för kartan
df <- valresultat_kommun %>% 
  filter(År == "2022") %>% 
  group_by(Kommun , Färg) %>% 
  reframe(Andel = sum(Andel)) %>% 
  group_by(Kommun) %>%
  filter(Andel != min(Andel)) %>%
  ungroup()

kommuner_karta <- kommuner_karta %>% 
  left_join(df %>% select(Kommun, Färg , Andel), by = "Kommun")


# Partisympatier efter kön och ålder
partisympati_kön_ålder <- read_excel("data/partisympati_kön_ålder.xlsx", 
     col_types = c("numeric", "text", "text", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric"))
colnames(partisympati_kön_ålder) <- c("År" , "Kön" , "Ålder" , "Moderaterna" , "Centerpartiet" , "Liberalerna" , 
                                      "Kristdemokraterna" , "Miljöpartiet" , "Socialdemokraterna" , "Vänsterpartiet" , 
                                      "Sverigedemokraterna" , "Övriga partier")

# Partisympatier efter kön och utbildningsnivå
partisympati_kön_utb <- read_excel("data/partisympati_kön_utb.xlsx", 
     col_types = c("numeric", "text", "text", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric"))
colnames(partisympati_kön_utb) <- c("År" , "Kön" , "Utbildning" , "Moderaterna" , "Centerpartiet" , "Liberalerna" , 
                                      "Kristdemokraterna" , "Miljöpartiet" , "Socialdemokraterna" , "Vänsterpartiet" , 
                                      "Sverigedemokraterna" , "Övriga partier")

# Partisympatier efter kön och inkomst
partisympati_kön_inkomst <- read_excel("data/partisympati_kön_inkomst.xlsx", 
     col_types = c("numeric", "text", "text", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric"))
colnames(partisympati_kön_inkomst) <- c("År" , "Kön" , "Inkomst" , "Moderaterna" , "Centerpartiet" , "Liberalerna" , 
                                      "Kristdemokraterna" , "Miljöpartiet" , "Socialdemokraterna" , "Vänsterpartiet" , 
                                      "Sverigedemokraterna" , "Övriga partier")

# Partisympati efter kön och bakgrund
partisympati_kön_bakgrund <- read_excel("data/partisympati_kön_bakgrund.xlsx", 
     col_types = c("numeric", "text", "text", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric"))
colnames(partisympati_kön_bakgrund) <- c("År" , "Kön" , "Bakgrund" , "Moderaterna" , "Centerpartiet" , "Liberalerna" , 
                                      "Kristdemokraterna" , "Miljöpartiet" , "Socialdemokraterna" , "Vänsterpartiet" , 
                                      "Sverigedemokraterna" , "Övriga partier")

# Förtroendevalda efter kön och ålder
förtroendevalda_kommun_ålder <- read_excel("data/förtroendevalda_kommun_ålder.xlsx")
förtroendevalda_kommun_ålder <- förtroendevalda_kommun_ålder %>% 
  pivot_longer(!c(Parti, Kön, Kategori, Mätvariabel) , names_to = "År" , values_to = "Andel")

# Förtroendevalda efter kön och utbildning
förtroendevalda_kommun_utbildning <- read_excel("data/förtroendevalda_kommun_utbildning.xlsx")
förtroendevalda_kommun_utbildning <- förtroendevalda_kommun_utbildning %>% 
  pivot_longer(!c(Parti, Kön, Utbildning, Mätvariabel) , names_to = "År" , values_to = "Andel")

# Förtroendevalda efter kön och inkomst
förtroendevalda_kommun_inkomst <- read_excel("data/förtroendevalda_kommun_inkomst.xlsx")
förtroendevalda_kommun_inkomst <- förtroendevalda_kommun_inkomst %>% 
  pivot_longer(!c(Parti, Kön, Inkomstpercentil, Mätvariabel) , names_to = "År" , values_to = "Andel")

# Förtroendevalda efter kön och bakgrund
förtroendevalda_kommun_bakgrund <- read_excel("data/förtroendevalda_kommun_bakgrund.xlsx")
förtroendevalda_kommun_bakgrund <- förtroendevalda_kommun_bakgrund %>% 
  pivot_longer(!c(Parti, Kön, Bakgrund, Mätvariabel) , names_to = "År" , values_to = "Andel")

# Tema
ss_theme <- theme(plot.background = element_rect(fill = "#EB6864") ,
                  plot.caption = element_text(hjust = 0) ,
                  panel.background = element_rect(fill = "white"),
                  axis.line.x = element_line(color = "black" , linewidth = 0.75) ,
                  axis.line.y = element_line(color = "black" , linewidth = 0.75) ,
                  plot.title = element_text(color = "white" , size = 16 , family = "sans"),
                  panel.grid.major.y  = element_line(color = "#B51E17" , linetype = "dotted"),
                  panel.grid.major.x = element_line(NULL),
                  panel.grid.minor = element_line(NULL),
                  legend.background = element_rect(fill = "white"),
                  legend.key = element_rect(fill = "white"),
                  legend.text = element_text(color = "black" , family = "sans") ,
                  legend.title = element_text(color = "black" , family = "sans") , 
                  text = element_text(size=12, face="plain", color = "white" , family = "sans"),
                  axis.title = element_text(color = "white" , family = "sans" , size = 18),
                  axis.text = element_text(color = "white" , family = "sans") ,
                  axis.text.x = element_text(size = 12))

# Partifärger
partifärger_colour <- scale_colour_manual(values = c("Centerpartiet" = "#009933" ,
                                              "Feministiskt initiativ" = "#CD1B68" ,
                                              "Kristdemokraterna" = "#000077" ,
                                              "Liberalerna" = "#006AB3" ,
                                              "Miljöpartiet" = "#83CF39" ,
                                              "Moderaterna" = "#52BDEC" ,
                                              "Piratpartiet" = "#572B85" ,
                                              "Socialdemokraterna" = "#E8112d" , 
                                              "Sverigedemokraterna" = "#DDDD00" ,
                                              "Vänsterpartiet" = "#DA291C" ,
                                              "Junilistan" = "#ff8c00" ,
                                              "Övriga partier" = "grey"))

partifärger_fill <- scale_fill_manual(values = c("Centerpartiet" = "#009933" ,
                                              "Feministiskt initiativ" = "#CD1B68" ,
                                              "Kristdemokraterna" = "#000077" ,
                                              "Liberalerna" = "#006AB3" ,
                                              "Miljöpartiet" = "#83CF39" ,
                                              "Moderaterna" = "#52BDEC" ,
                                              "Piratpartiet" = "#572B85" ,
                                              "Socialdemokraterna" = "#E8112d" , 
                                              "Sverigedemokraterna" = "#DDDD00" ,
                                              "Vänsterpartiet" = "#DA291C" ,
                                              "Junilistan" = "#ff8c00" ,
                                              "Övriga partier" = "grey"))

```

# Översikt {data-orientation="rows"}
## {data-height=200}
### Om initiativet
*Svensk statistik* är ett initiativ med det huvudsakliga syftet att visualisera utvecklingen i Sverige utifrån ett antal parametrar. Genom SCB är Sverige ett land som ligger i framkant i att lagra registerdata och föra annan statistik på befolkningsnivå, men denna statistik är inte alltid så enkel att ta till sig. Detta är ett försök att förenkla möjligheten att ta till sig av denna data.
<br><br>

## {data-height=400}
### Om rapporten 
I denna rapport bemöts området **Demokrati** utifrån dessa områden:
<br><br>
- **Val**: Valdeltagande och valresultat över tid. <br>
- **Partisympatier**: Partisympatier utifrån kön, ålder, utbildningsnivå, inkomst och bakgrund. <br>
- **Förtroendevalda**: Förtroendevalda utifrån kön, ålder, utbildningsnivå, inkomst och bakgrund.
<br> <br>
Använd navigationspanelen högst upp för att se svaren utifrån olika områden. *Får figurerna inte plats på sidan? Testa att zooma ut genom att hålla in `Ctrl` + `-`.*


##
### Rapporter
<div style="display: flex; justify-content: space-between; gap: 10px;">
  <a href="https://lindw3.github.io/svenskstatistik-demokrati/" target="_blank">
    <img src="C:/Users/WILIDF17/OneDrive - Sveriges Riksidrottsförbund/Dokument/GitHub/svenskstatistik/bilder/demokrati.png" width="30%">
  </a>
  <a href="https://lindw3.github.io/svenskstatistik-arbete/" target="_blank">
    <img src="C:/Users/WILIDF17/OneDrive - Sveriges Riksidrottsförbund/Dokument/GitHub/svenskstatistik/bilder/arbete.png" width="30%">
  </a>
  <a href="https://lindw3.github.io/svenskstatistik-demokrati/" target="_blank">
    <img src="C:/Users/WILIDF17/OneDrive - Sveriges Riksidrottsförbund/Dokument/GitHub/svenskstatistik/bilder/utbildning.png" width="30%">
  </a>
</div>






# Val {data-orientation="columns"}
##  {.tabset .tabset-pills data-width="400"}
### Valdeltagande
```{r}
df <- valdeltagande %>% 
  pivot_longer(!Val, names_to = "År", values_to = "Andel")

df %>%
  ggplot(aes(x = År, y = Andel, group = Val, color = Val,
             text = paste("År: ", År, "\nVal: " , Val , "\nAndel: ", Andel , "%"))) +
  geom_line(linewidth = 1) +
  scale_y_continuous(labels = percent_format(scale = 1), breaks = seq(0, 100, 25), limits = c(0, 100)) +
  scale_x_discrete(breaks = c("1973" , "2022")) +
  ss_theme +
  scale_color_manual(values = c("Riksdag" = "#006AB3",
                                "Region" = "#DA291C",
                                "Kommun" =  "#009933"))   -> p_valdeltagande

ggplotly(p_valdeltagande, tooltip = "text") %>%
  config(displayModeBar = F)
```


##  {.tabset .tabset-pills data-width="600"}

### Valresultat i Sverige
```{r}
df <- valresultat_sverige %>%
  pivot_longer(!År, names_to = "Parti", values_to = "Röster")

df %>%
  ggplot(aes(x = År, y = Röster, group = Parti, colour = Parti,
             text = paste("År: ", År, "\nParti: ", Parti, "\nRöster: ", Röster, "%"))) +
  geom_line(linewidth = 1) +
  scale_y_continuous(labels = percent_format(scale = 1), breaks = seq(0, 50, 5), limits = c(0, 50)) +
  scale_x_discrete(breaks = c("1973" , "2022")) +
  ss_theme +
  partifärger_colour -> p_valresultat_sverige

ggplotly(p_valresultat_sverige, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle"))
```


### Valresultat i Europaval
```{r}
df <- valresultat_eu %>%
  pivot_longer(!År, names_to = "Parti", values_to = "Röster")

df %>%
  ggplot(aes(x = År, y = Röster, group = Parti, colour = Parti,
             text = paste("År: ", År, "\nParti: ", Parti, "\nRöster: ", Röster, "%"))) +
  geom_line(linewidth = 1) +
  scale_y_continuous(labels = percent_format(scale = 1), breaks = seq(0, 30, 5), limits = c(0, 30)) +
  scale_x_discrete(breaks = c("1995" , "2024")) +
  ss_theme +
  partifärger_colour -> p_valresultat_eu

ggplotly(p_valresultat_eu, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 
```


### Valresultat i kommunval efter block
```{r}
kommuner_karta %>% 
ggplot(aes(text = paste(Kommun , "\nPolitisk färg: " , Färg , "\nAndel: " , Andel))) +
  geom_sf(aes(fill = Färg)) +
  ss_theme +
  scale_fill_manual(values = c("Blå" = "#006AB3" ,
                               "Röd" = "#DA291C") , labels = c("Höger" , "Vänster")) +
  labs(fill = "Partisympati efter block") +
  theme(panel.grid.major = NULL,
        panel.grid.minor = NULL, 
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank()) -> p_kommunval

p_kommunval
```












# Partisympatier efter kön {data-navmenu="Partisympatier"}
## {.tabset .tabset-pills}

### Partisympatier efter kön
```{r}
df <- partisympati_kön_ålder %>% 
  filter(Ålder == "Totalt" ,
         År == 2024 ,
         Kön != "Båda") %>%
  pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = Kön,
             text = paste(Parti, "\nKön: ", Kön, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  ss_theme +
  scale_fill_manual(values = c("Kvinnor" = "#ffb1b1",
                               "Män" = "#64b6ee")) -> p_partisympatier_kön

ggplotly(p_partisympatier_kön, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 
```


### Vänster/högersympatier efter kön
```{r}
df <- partisympati_kön_ålder %>% 
  filter(Kön != "Båda") %>% 
  pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")

df_blå <- df %>%
  filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
  group_by(År, Kön , Ålder) %>% 
  summarise(Blå = sum(Andel, na.rm = TRUE))

df_röd <- df %>%
  filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna", 
                      "Vänsterpartiet", "Centerpartiet")) %>%
  group_by(År, Kön , Ålder) %>% 
  summarise(Röd = sum(Andel, na.rm = TRUE))

df_combined <- cbind(df_blå, df_röd) 
df_combined <- df_combined %>%
  select(-c(5, 6, 7))
colnames(df_combined) <- c("År" , "Kön" , "Ålder" , "Blå" , "Röd")

df_combined <- df_combined %>% 
  mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 3) ,
         Kön_Ålder = paste(Kön, Ålder, sep = ", "))
df_combined$År <- as.factor(df_combined$År)
df_combined$highlight <- ifelse(df_combined$Kön_Ålder %in% c("Kvinnor, Totalt", "Män, Totalt"), 1.5, 0.5)


df_combined %>% 
  filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
                    "2009", "2010", "2011" , 
                    "2012" , "2013" , "2014" , 
                    "2015" , "2016" ,"2017")) %>% 
  ggplot(aes(x = År , y = Blocktillhörighet , group = Kön_Ålder , color = Kön_Ålder , size = highlight ,
             text = paste(År, "\nKategori: " , Kön_Ålder, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
  geom_line() +  
  scale_size_identity() + 
  scale_y_continuous(limits = c(0, 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(breaks = c("2018" , "2024")) +
  scale_color_manual(values = c("Kvinnor, 18-29" = "#ffb1b1",
                                "Kvinnor, 30-49" = "#ff6262",
                                "Kvinnor, 50-64" = "#ff3b3b",
                                "Kvinnor, 65+" = "#ff0000" ,
                                "Kvinnor, Totalt" = "#b30000", 
                                "Män, 18-29" = "#b0e0e6",
                                "Män, 30-49" = "#64b6ee",
                                "Män, 50-64" = "#427bd2",
                                "Män, 65+" = "#2c43b0" ,
                                "Män, Totalt" = "#1e2791")) +
  labs(color = "Kategori") +
  ss_theme -> p_blocksympati_kön_ålder

ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Höger",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Vänster",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )


```




# Partisympatier efter ålder {data-navmenu="Partisympatier"}
## {.tabset .tabset-pills}

### Partisympatier efter ålderskategorier
```{r}
levels = c("65+" , "50-64" , "30-49" , "18-29")

df <- partisympati_kön_ålder %>% 
  filter(Ålder != "Totalt" ,
         År == 2024 ,
         Kön == "Båda") %>%
  pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = factor(Ålder , level = levels),
             text = paste(Parti, "\nÅlderskategori: ", Ålder, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Ålderskategori") +
  ss_theme +
  scale_fill_manual(values = c("18-29" = "#ffb1b1",
                               "30-49" = "#64b6ee" ,
                               "50-64" = "#94c58c",
                               "65+" = "#ffff9a")) -> p_partisympatier_kön

ggplotly(p_partisympatier_kön, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 


```



### Vänster/högersympatier efter ålder, tidslinje
```{r}
df <- partisympati_kön_ålder %>% 
  filter(Kön == "Båda") %>% 
  select(!Kön) %>% 
  filter(Ålder != "Totalt") %>% 
  pivot_longer(!c(År, Ålder) , names_to = "Parti" , values_to = "Andel")

df_blå <- df %>%
  filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
  group_by(År, Ålder) %>% 
  summarise(Blå = sum(Andel, na.rm = TRUE))

df_röd <- df %>%
  filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna", 
                      "Vänsterpartiet", "Centerpartiet")) %>%
  group_by(År, Ålder) %>% 
  summarise(Röd = sum(Andel, na.rm = TRUE))

df_combined <- cbind(df_blå, df_röd) 
df_combined <- df_combined %>%
  select(-c(4, 5))
colnames(df_combined) <- c("År" ,  "Ålder" , "Blå" , "Röd")

df_combined <- df_combined %>% 
  mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 3))
df_combined$År <- as.factor(df_combined$År)

df_combined %>% 
  filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
                    "2009", "2010", "2011" , 
                    "2012" , "2013" , "2014" , 
                    "2015" , "2016" ,"2017" , "2018")) %>% 
  ggplot(aes(x = År , y = Blocktillhörighet , group = Ålder , color = Ålder,
             text = paste(År, "\nKategori: " , Ålder, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0, 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(breaks = c("2019" , "2024")) +
  scale_color_manual(values = c("18-29" = "#ffb1b1",
                               "30-49" = "#64b6ee" ,
                               "50-64" = "#94c58c",
                               "65+" = "#ffff9a")) +
  ss_theme -> p_blocksympati_ålder

ggplotly(p_blocksympati_ålder, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Höger",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Vänster",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )


```


# Partisympatier efter utbildning {data-navmenu="Partisympatier"}
## {.tabset .tabset-pills}

### Partisympatier efter utbildningsbakgrund
```{r}
levels = c("Eftergymnasial, 3+ år" , "Eftergymnasial, -3 år" ,  "Gymnasial" , "Förgymnasial")

df <- partisympati_kön_utb %>% 
  filter(År == 2024 ,
         Kön == "Båda") %>%
  pivot_longer(!c(År, Kön, Utbildning) , names_to = "Parti" , values_to = "Andel")

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = factor(Utbildning , level = levels),
             text = paste(Parti, "\nUtbildning: ", Utbildning, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Utbildningsnivå") +
  ss_theme +
  scale_fill_manual(values = c("Förgymnasial" = "#ffb1b1",
                               "Gymnasial" = "#64b6ee" ,
                               "Eftergymnasial, -3 år" = "#94c58c",
                               "Eftergymnasial, 3+ år" = "#ffff9a")) -> p_partisympatier_utb

ggplotly(p_partisympatier_utb, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 
```


### Vänster/högersympatier efter utbildningsbakgrund, tidslinje
```{r}
df <- partisympati_kön_utb %>% 
  filter(Kön == "Båda") %>% 
  select(!Kön) %>% 
  pivot_longer(!c(År, Utbildning) , names_to = "Parti" , values_to = "Andel")

df_blå <- df %>%
  filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
  group_by(År, Utbildning) %>% 
  summarise(Blå = sum(Andel, na.rm = TRUE))

df_röd <- df %>%
  filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna", 
                      "Vänsterpartiet", "Centerpartiet")) %>%
  group_by(År, Utbildning) %>% 
  summarise(Röd = sum(Andel, na.rm = TRUE))

df_combined <- cbind(df_blå, df_röd) 
df_combined <- df_combined %>%
  select(-c(4, 5))
colnames(df_combined) <- c("År" ,  "Utbildning" , "Blå" , "Röd")

df_combined <- df_combined %>% 
  mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 3))
df_combined$År <- as.factor(df_combined$År)

df_combined %>% 
  filter(!År %in% c("2005" , "2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
                    "2009", "2010", "2011" , 
                    "2012" , "2013" , "2014" , 
                    "2015" , "2016" ,"2017" , "2018")) %>% 
  ggplot(aes(x = År , y = Blocktillhörighet , group = Utbildning , color = Utbildning,
             text = paste(År, "\nUtbildning: " , Utbildning, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0, 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(breaks = c("2019" , "2024")) +
  scale_color_manual(values = c("Förgymnasial" = "#ffb1b1",
                               "Gymnasial" = "#64b6ee" ,
                               "Eftergymnasial, -3 år" = "#94c58c",
                               "Eftergymnasial, 3+ år" = "#ffff9a")) +
  ss_theme -> p_blocksympati_utb

ggplotly(p_blocksympati_utb, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Höger",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Vänster",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )

```






# Partisympatier efter inkomst {data-navmenu="Partisympatier"}
## {.tabset .tabset-pills}

### Partisympatier efter inkomstpercentil
```{r}
levels = c("81-100 %" , "61-80 %" ,  "41-60 %" , "21-40 %" , "0-20 %")

df <- partisympati_kön_inkomst %>% 
  filter(År == 2024 ,
         Kön == "Båda") %>%
  pivot_longer(!c(År, Kön, Inkomst) , names_to = "Parti" , values_to = "Andel")

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = factor(Inkomst , level = levels),
             text = paste(Parti, "\nInkomst: ", Inkomst, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Inkomstpercentil") +
  ss_theme +
  scale_fill_manual(values = c("0-20 %" = "#ffb1b1",
                               "21-40 %" = "#64b6ee" ,
                               "41-60 %" = "#94c58c",
                               "61-80 %" = "#ffff9a" ,
                               "81-100 %" = "#ffcff1")) -> p_partisympatier_inkomst

ggplotly(p_partisympatier_inkomst, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 


```

### Vänster/högersympatier efter inkomstpercentil, tidslinje
```{r}
df <- partisympati_kön_inkomst %>% 
  filter(Kön == "Båda") %>% 
  select(!Kön) %>% 
  pivot_longer(!c(År, Inkomst) , names_to = "Parti" , values_to = "Andel")

df_blå <- df %>%
  filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
  group_by(År, Inkomst) %>% 
  summarise(Blå = sum(Andel, na.rm = TRUE))

df_röd <- df %>%
  filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna", 
                      "Vänsterpartiet", "Centerpartiet")) %>%
  group_by(År, Inkomst) %>% 
  summarise(Röd = sum(Andel, na.rm = TRUE))

df_combined <- cbind(df_blå, df_röd) 
df_combined <- df_combined %>%
  select(-c(4, 5))
colnames(df_combined) <- c("År" ,  "Inkomst" , "Blå" , "Röd")

df_combined <- df_combined %>% 
  mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 3))
df_combined$År <- as.factor(df_combined$År)

df_combined %>% 
  filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
                    "2009", "2010", "2011" , 
                    "2012" , "2013" , "2014" , 
                    "2015" , "2016" ,"2017" , "2018")) %>% 
  ggplot(aes(x = År , y = Blocktillhörighet , group = Inkomst , color = Inkomst,
             text = paste(År, "\nInkomst: " , Inkomst, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0, 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(breaks = c("2019" , "2024")) +
  scale_color_manual(values = c("0-20 %" = "#ffb1b1",
                               "21-40 %" = "#64b6ee" ,
                               "41-60 %" = "#94c58c",
                               "61-80 %" = "#ffff9a" ,
                               "81-100 %" = "#ffcff1")) +
  ss_theme -> p_blocksympati_inkomst

ggplotly(p_blocksympati_inkomst, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Höger",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Vänster",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )


```







# Partisympatier efter bakgrund {data-navmenu="Partisympatier"}
## {.tabset .tabset-pills}

### Partisympatier utifrån 
```{r}
df <- partisympati_kön_bakgrund %>% 
  filter(År == 2024 ,
         Kön == "Båda") %>%
  pivot_longer(!c(År, Kön, Bakgrund) , names_to = "Parti" , values_to = "Andel")

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = Bakgrund,
             text = paste(Parti, "\nBakgrund: ", Bakgrund, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Bakgrund") +
  ss_theme +
  scale_fill_manual(values = c("Utländsk" = "#ffb1b1",
                               "Svensk" = "#64b6ee")) -> p_partisympatier_bakgrund

ggplotly(p_partisympatier_bakgrund, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 
```


### Vänster/högersympatier efter inkomstpercentil, tidslinje
```{r}
df <- partisympati_kön_bakgrund %>% 
  filter(Kön == "Båda") %>% 
  select(!Kön) %>% 
  pivot_longer(!c(År, Bakgrund) , names_to = "Parti" , values_to = "Andel")

df_blå <- df %>%
  filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
  group_by(År, Bakgrund) %>% 
  summarise(Blå = sum(Andel, na.rm = TRUE))

df_röd <- df %>%
  filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna", 
                      "Vänsterpartiet", "Centerpartiet")) %>%
  group_by(År, Bakgrund) %>% 
  summarise(Röd = sum(Andel, na.rm = TRUE))

df_combined <- cbind(df_blå, df_röd) 
df_combined <- df_combined %>%
  select(-c(4, 5))
colnames(df_combined) <- c("År" ,  "Bakgrund" , "Blå" , "Röd")

df_combined <- df_combined %>% 
  mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 3))
df_combined$År <- as.factor(df_combined$År)

df_combined %>% 
  filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
                    "2009", "2010", "2011" , 
                    "2012" , "2013" , "2014" , 
                    "2015" , "2016" ,"2017" , "2018")) %>% 
  ggplot(aes(x = År , y = Blocktillhörighet , group = Bakgrund , color = Bakgrund,
             text = paste(År, "\nBakgrund: " , Bakgrund, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0, 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(breaks = c("2019" , "2024")) +
  scale_color_manual(values = c("Utländsk" = "#ffb1b1",
                               "Svensk" = "#64b6ee")) +
  ss_theme -> p_blocksympati_bakgrund

ggplotly(p_blocksympati_bakgrund, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Höger",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Vänster",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )
```

















# Förtroendevalda efter kön {data-navmenu="Förtroendevalda i kommuner"}
##
### Andel förtroendevalda efter kön och parti
```{r}
df <- förtroendevalda_kommun_ålder %>% 
  filter(Kategori == "Totalt" ,
         Kön != "Båda" ,
         Mätvariabel == "Könsfördelning" ,
         År == "2023-2026" ,
         Parti != "Totalt") %>% 
  group_by(Parti, Kön) %>% 
  summarize(Andel = Andel)

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = Kön,
             text = paste(Parti, "\nKön: ", Kön, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Kön") +
  ss_theme +
  scale_fill_manual(values = c("Kvinnor" = "#ffb1b1",
                               "Män" = "#64b6ee")) -> p_förtroendevalda_kön

ggplotly(p_förtroendevalda_kön, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 

```



### Könsfördelning utifrån parti, tidslinje
```{r}
df <- förtroendevalda_kommun_ålder %>% 
  filter(Kön == "Män",
         Mätvariabel == "Könsfördelning" ,
         Kategori == "Totalt"
         )
df %>% 
  ggplot(aes(x = År , y = Andel/100 , group = Parti , color = Parti,
             text = paste(År, "\nParti: " , Parti, "\nAndel män: " , Andel , "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0 , 1), 
                     breaks = c(0.5), 
                     labels = scales::percent_format(accuracy = 1)) +
  ylab("Andel, %") +
  partifärger_colour +
  ss_theme -> p_förtroendevalda_kön_år

ggplotly(p_förtroendevalda_kön_år, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Män",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Kvinnor",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )
```



# Förtroendevalda efter ålder {data-navmenu="Förtroendevalda i kommuner"}
##
### Andel förtroendevalda i kommuner efter ålderskategori
```{r}
levels = c("65+ år" , "50-64 år" , "30-49 år" , "18-29 år")

df <- förtroendevalda_kommun_ålder %>% 
  filter(Kategori != "Totalt" ,
         Kön == "Båda" ,
         Mätvariabel == "Förtroendevalda, andel" ,
         År == "2023-2026" ,
         Parti != "Totalt") %>% 
  group_by(Parti, Kategori) %>% 
  summarize(Andel = Andel)

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = factor(Kategori, levels = levels),
             text = paste(Parti, "\nÅlder: ", Kategori, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Ålder") +
  ss_theme +
  scale_fill_manual(values = c("18-29 år" = "#ffb1b1",
                               "30-49 år" = "#64b6ee" ,
                               "50-64 år" = "#94c58c",
                               "65+ år" = "#ffff9a")) -> p_förtroendevalda_ålder

ggplotly(p_förtroendevalda_ålder, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 

```




### Könsfördelning utifrån ålderskategorier, tidslinje
```{r}
df <- förtroendevalda_kommun_ålder %>% 
  filter(Kön == "Män",
         Mätvariabel == "Könsfördelning" ,
         Kategori != "Totalt" ,
         Parti == "Totalt"
         )
df %>% 
  ggplot(aes(x = År , y = Andel/100 , group = Kategori , color = Kategori,
             text = paste(År, "\nÅlder: " , Kategori, "\nAndel män: " , Andel , "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0 , 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  ylab("Andel, %") +
  scale_colour_manual(values = c("18-29 år" = "#ffb1b1",
                               "30-49 år" = "#64b6ee" ,
                               "50-64 år" = "#94c58c",
                               "65+ år" = "#ffff9a")) +
  ss_theme -> p_förtroendevalda_kön_ålder_år

ggplotly(p_förtroendevalda_kön_ålder_år, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Män",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Kvinnor",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )
```



# Förtroendevalda efter utbildning {data-navmenu="Förtroendevalda i kommuner"}
##
### Andel förtroendevalda i kommuner efter utbildning
```{r}
levels = c("Eftergymnasial" , "Gymnasial" , "Förgymnasial")

df <- förtroendevalda_kommun_utbildning %>% 
  filter(Kön == "Båda" ,
         Mätvariabel == "Förtroendevalda" ,
         År == "2023-2026" ,
         Parti != "Totalt") %>% 
  group_by(Parti, Utbildning) %>% 
  summarize(Andel = Andel)

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = factor(Utbildning, levels = levels),
             text = paste(Parti, "\nUtbildningsnivå: ", Utbildning, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Utbildning") +
  ss_theme +
  scale_fill_manual(values = c("Förgymnasial" = "#ffb1b1",
                               "Gymnasial" = "#64b6ee" ,
                               "Eftergymnasial" = "#94c58c")) -> p_förtroendevalda_utbildning

ggplotly(p_förtroendevalda_utbildning, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 

```


### Könsfördelning utifrån utbildning, tidslinje
```{r}
df <- förtroendevalda_kommun_utbildning %>% 
  filter(Kön == "Män",
         Mätvariabel == "Könsfördelning" ,
         Utbildning != "Totalt" ,
         Parti == "Totalt"
         )
df %>% 
  ggplot(aes(x = År , y = Andel/100 , group = Utbildning , color = Utbildning,
             text = paste(År, "\nUtbildningsnivå: " , Utbildning, "\nAndel män: " , Andel , "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0 , 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  ylab("Andel, %") +
  scale_colour_manual(values = c("Förgymnasial" = "#ffb1b1",
                               "Gymnasial" = "#64b6ee" ,
                               "Eftergymnasial" = "#94c58c")) +
  ss_theme -> p_förtroendevalda_kön_utbildning_år

ggplotly(p_förtroendevalda_kön_utbildning_år, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Män",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Kvinnor",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )

```




# Förtroendevalda efter inkomst {data-navmenu="Förtroendevalda i kommuner"}
##
### Andel förtroendevalda i kommuner efter inkomstpercentil
```{r}
levels = c("81-100" , "61-80" , "41-60" , "21-40" , "0-20")

df <- förtroendevalda_kommun_inkomst %>% 
  filter(Kön == "Båda" ,
         Mätvariabel == "Förtroendevalda" ,
         År == "2023-2026" ,
         Parti != "Totalt") %>% 
  group_by(Parti, Inkomstpercentil) %>% 
  summarize(Andel = Andel)

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = factor(Inkomstpercentil, levels = levels),
             text = paste(Parti, "\nInkomstpercentil: ", Inkomstpercentil, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Inkomstpercentil") +
  ss_theme +
  scale_fill_manual(values = c("0-20" = "#ffb1b1",
                               "21-40" = "#64b6ee" ,
                               "41-60" = "#94c58c",
                               "61-80" = "#ffff9a" ,
                               "81-100" = "#ffcff1")) -> p_förtroendevalda_inkomst

ggplotly(p_förtroendevalda_inkomst, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 

```


### Könsfördelning utifrån inkomst, tidslinje
```{r}
df <- förtroendevalda_kommun_inkomst %>% 
  filter(Kön == "Män",
         Mätvariabel == "Könsfördelning" ,
         Inkomstpercentil != "Totalt" ,
         Parti == "Totalt"
         )
df %>% 
  ggplot(aes(x = År , y = Andel/100 , group = Inkomstpercentil , color = Inkomstpercentil,
             text = paste(År, "\nInkomstpercentil: " , Inkomstpercentil, "\nAndel män: " , Andel , "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0 , 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  ylab("Andel, %") +
  scale_colour_manual(values = c("0-20" = "#ffb1b1",
                               "21-40" = "#64b6ee" ,
                               "41-60" = "#94c58c",
                               "61-80" = "#ffff9a" ,
                               "81-100" = "#ffcff1")) +
  ss_theme -> p_förtroendevalda_kön_inkomst_år

ggplotly(p_förtroendevalda_kön_inkomst_år, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Män",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Kvinnor",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )
```




# Förtroendevalda efter bakgrund {data-navmenu="Förtroendevalda i kommuner"}
##
### Andel förtroendevalda i kommuner efter bakgrund
```{r}
levels = c("Inrikes" , "Utrikes")

df <- förtroendevalda_kommun_bakgrund %>% 
  filter(Kön == "Båda" ,
         Mätvariabel == "Förtroendevalda" ,
         År == "2023-2026" ,
         Parti != "Totalt") %>% 
  group_by(Parti, Bakgrund) %>% 
  summarize(Andel = Andel)

df %>% 
  ggplot(aes(y = Parti, x = Andel, fill = factor(Bakgrund, levels = levels),
             text = paste(Parti, "\nBakgrund: ", Bakgrund, "\nAndel: ", Andel, "%"))) +
  geom_col(position = "dodge") +
  xlab("Andel, %") +
  labs(fill = "Bakgrund") +
  ss_theme +
  scale_x_continuous(breaks = c(0 , 100) , limits = c(0 , 100)) +
  scale_fill_manual(values = c("Inrikes" = "#ffb1b1",
                               "Utrikes" = "#64b6ee")) -> p_förtroendevalda_bakgrund

ggplotly(p_förtroendevalda_bakgrund, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) 
```


### Könsfördelning utifrån bakgrund, tidslinje
```{r}
df <- förtroendevalda_kommun_bakgrund %>% 
  filter(Kön == "Män",
         Mätvariabel == "Könsfördelning" ,
         Bakgrund != "Totalt" ,
         Parti == "Totalt"
         )
df %>% 
  ggplot(aes(x = År , y = Andel/100 , group = Bakgrund , color = Bakgrund,
             text = paste(År, "\nBakgrund: " , Bakgrund, "\nAndel män: " , Andel , "%"))) +
  geom_line(linewidth = 1) +  
  scale_y_continuous(limits = c(0 , 1), 
                     breaks = 0.5, 
                     labels = scales::percent_format(accuracy = 1)) +
  ylab("Andel, %") +
  scale_colour_manual(values = c("Inrikes" = "#ffb1b1",
                               "Utrikes" = "#64b6ee")) +
  ss_theme -> p_förtroendevalda_kön_bakgrund_år

ggplotly(p_förtroendevalda_kön_bakgrund_år, tooltip = "text") %>%
  config(displayModeBar = F) %>%
  layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.9, yref = "paper",
    text = "Män",
    showarrow = FALSE,
    font = list(color = "#1e2791", size = 16 , family = "Arial Black")
  ) %>%
  add_annotations(
    x = 0.5, xref = "paper",
    y = 0.1, yref = "paper",
    text = "Kvinnor",
    showarrow = FALSE,
    font = list(color = "#b30000", size = 16 , family = "Arial Black")
  )
```
