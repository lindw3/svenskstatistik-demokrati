geom_col(position = "dodge") +
ss_theme +
scale_fill_manual(values = c("Kvinnor" = "#DDDD00",
"Män" = "#ff8c00"))
library(flexdashboard)
library(ggplot2)
library(stringr)
library(scales)
library(dplyr)
library(tidyr)
library(DT)
library(png)
library(data.table)
library(magrittr)
library(gridExtra)
library(openxlsx)
library(forcats)
library(patchwork)
library(ggthemes)
library(plotly)
library(ggridges)
library(forecast)
library(GGally)
library(cluster)
library(sf)
library(ggrepel)
library(ggtext)
df <- partisympati_kön_ålder %>%
filter(Kön != "Båda") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df_blå <- df %>%
filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
group_by(År, Kön , Ålder) %>%
summarise(Blå = sum(Andel, na.rm = TRUE))
df_röd <- df %>%
filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna",
"Vänsterpartiet", "Centerpartiet")) %>%
group_by(År, Kön , Ålder) %>%
summarise(Röd = sum(Andel, na.rm = TRUE))
df_combined <- cbind(df_blå, df_röd)
df_combined <- df_combined %>%
select(-c(5, 6, 7))
colnames(df_combined) <- c("År" , "Kön" , "Ålder" , "Blå" , "Röd")
df_combined <- df_combined %>%
mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 2) ,
Kön_Ålder = paste(Kön, Ålder, sep = ", "))
df_combined$År <- as.factor(df_combined$År)
df_combined$highlight <- ifelse(df_combined$Kön_Ålder %in% c("Kvinnor, Totalt", "Män, Totalt"), 1.5, 0.5)
df_combined %>%
filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
"2009", "2010", "2011" ,
"2012" , "2013" , "2014" ,
"2015" , "2016" ,"2017")) %>%
ggplot(aes(x = År , y = Blocktillhörighet , group = Kön_Ålder , color = Kön_Ålder , size = highlight ,
text = paste(År, "\nKategori: " , Kön_Ålder, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
geom_line() +
scale_size_identity() +
scale_y_continuous(limits = c(0.25, 0.75),
breaks = 0.5,
labels = scales::percent_format(accuracy = 1)) +
scale_x_discrete(breaks = c("2018" , "2024")) +
scale_color_manual(values = c("Kvinnor, 18-29" = "#ffb1b1",
"Kvinnor, 30-49" = "#ff6262",
"Kvinnor, 50-64" = "#ff3b3b",
"Kvinnor, 65+" = "#ff0000" ,
"Kvinnor, Totalt" = "#b30000",
"Män, 18-29" = "#b0e0e6",
"Män, 30-49" = "#64b6ee",
"Män, 50-64" = "#427bd2",
"Män, 65+" = "#2c43b0" ,
"Män, Totalt" = "#1e2791")) +
labs(color = "Kategori") +
ss_theme
ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
config(displayModeBar = F) %>%
layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
add_annotations(
x = "2018", xref = "x",
y = 0.6, yref = "y",
text = "Höger",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = -20
) %>%
add_annotations(
x = "2018", xref = "x",
y = 0.4, yref = "y",
text = "Vänster",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = 20
) %>%
layout(
shapes = list(
list(
type = "line",
x0 = "2018", x1 = "2018", xref = "x",
y0 = 0.4, y1 = 0.6, yref = "y",
line = list(color = "black", dash = "dot")
)
)
)
df <- partisympati_kön_ålder %>%
filter(Kön != "Båda") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df_blå <- df %>%
filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
group_by(År, Kön , Ålder) %>%
summarise(Blå = sum(Andel, na.rm = TRUE))
df_röd <- df %>%
filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna",
"Vänsterpartiet", "Centerpartiet")) %>%
group_by(År, Kön , Ålder) %>%
summarise(Röd = sum(Andel, na.rm = TRUE))
df_combined <- cbind(df_blå, df_röd)
df_combined <- df_combined %>%
select(-c(5, 6, 7))
colnames(df_combined) <- c("År" , "Kön" , "Ålder" , "Blå" , "Röd")
df_combined <- df_combined %>%
mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 2) ,
Kön_Ålder = paste(Kön, Ålder, sep = ", "))
df_combined$År <- as.factor(df_combined$År)
df_combined$highlight <- ifelse(df_combined$Kön_Ålder %in% c("Kvinnor, Totalt", "Män, Totalt"), 1.5, 0.5)
df_combined %>%
filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
"2009", "2010", "2011" ,
"2012" , "2013" , "2014" ,
"2015" , "2016" ,"2017")) %>%
ggplot(aes(x = År , y = Blocktillhörighet , group = Kön_Ålder , color = Kön_Ålder , size = highlight ,
text = paste(År, "\nKategori: " , Kön_Ålder, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
geom_line() +
scale_size_identity() +
scale_y_continuous(limits = c(0.25, 0.75),
breaks = 0.5,
labels = scales::percent_format(accuracy = 1)) +
scale_x_discrete(breaks = c("2018" , "2024")) +
scale_color_manual(values = c("Kvinnor, 18-29" = "#ffb1b1",
"Kvinnor, 30-49" = "#ff6262",
"Kvinnor, 50-64" = "#ff3b3b",
"Kvinnor, 65+" = "#ff0000" ,
"Kvinnor, Totalt" = "#b30000",
"Män, 18-29" = "#b0e0e6",
"Män, 30-49" = "#64b6ee",
"Män, 50-64" = "#427bd2",
"Män, 65+" = "#2c43b0" ,
"Män, Totalt" = "#1e2791")) +
labs(color = "Kategori") +
ss_theme -> p_blocksympati_kön_ålder
ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
config(displayModeBar = F) %>%
layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
add_annotations(
x = "2018", xref = "x",
y = 0.6, yref = "y",
text = "Höger",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = -20
) %>%
add_annotations(
x = "2018", xref = "x",
y = 0.4, yref = "y",
text = "Vänster",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = 20
) %>%
layout(
shapes = list(
list(
type = "line",
x0 = "2018", x1 = "2018", xref = "x",
y0 = 0.4, y1 = 0.6, yref = "y",
line = list(color = "black", dash = "dot")
)
)
)
df_combined
p <- ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
config(displayModeBar = F) %>%
layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle"))
p %>%   add_annotations(
x = "2018", xref = "x",
y = 0.6, yref = "y",
text = "Höger",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = -20
) %>%
add_annotations(
x = "2018", xref = "x",
y = 0.4, yref = "y",
text = "Vänster",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = 20
) %>%
layout(
shapes = list(
list(
type = "line",
x0 = "2018", x1 = "2018", xref = "x",
y0 = 0.4, y1 = 0.6, yref = "y",
line = list(color = "black", dash = "dot")
)
)
)
p <- p %>%add_annotations(
x = "2018", xref = "x",
y = 0.6, yref = "y",
text = "Höger",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = -20
) %>%
add_annotations(
x = "2018", xref = "x",
y = 0.4, yref = "y",
text = "Vänster",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = 20
) %>%
layout(
shapes = list(
list(
type = "line",
x0 = "2018", x1 = "2018", xref = "x",
y0 = 0.4, y1 = 0.6, yref = "y",
line = list(color = "black", dash = "dot")
)
)
)
p
p <- ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
config(displayModeBar = F) %>%
layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle"))
p <- p %>% add_annotations(
x = "2018", xref = "x",
y = 0.6, yref = "y",
text = "Höger",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = -20
) %>%
add_annotations(
x = "2018", xref = "x",
y = 0.4, yref = "y",
text = "Vänster",
showarrow = TRUE,
arrowhead = 2,
ax = 0,
ay = 20
) %>%
layout(
shapes = list(
list(
type = "line",
x0 = "2018", x1 = "2018", xref = "x",
y0 = 0.4, y1 = 0.6, yref = "y",
line = list(color = "black", dash = "dot")
)
)
)
p
ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
config(displayModeBar = F) %>%
layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
add_annotations(
x = -Inf, xref = "x",
y = 0.6, yref = "y",
text = "Höger",
showarrow = TRUE,
arrowhead = 2,
ax = 20,
ay = 0
) %>%
add_annotations(
x = -Inf, xref = "x",
y = 0.4, yref = "y",
text = "Vänster",
showarrow = TRUE,
arrowhead = 2,
ax = 20,
ay = 0
) %>%
layout(
shapes = list(
list(
type = "line",
x0 = -Inf, x1 = -Inf, xref = "x",
y0 = 0.4, y1 = 0.6, yref = "y",
line = list(color = "black", dash = "dot")
)
)
)
ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
config(displayModeBar = F) %>%
layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
add_annotations(
x = 0.5, xref = "paper",
y = 0.75, yref = "paper",
text = "Höger",
showarrow = FALSE,
font = list(color = "#1e2791", size = 14)
) %>%
add_annotations(
x = 0.5, xref = "paper",
y = 0.25, yref = "paper",
text = "Vänster",
showarrow = FALSE,
font = list(color = "#b30000", size = 14)
)
ggplotly(p_blocksympati_kön_ålder, tooltip = "text") %>%
config(displayModeBar = F) %>%
layout(legend = list(x = 1.05, y = 0.5, xanchor = "left", yanchor = "middle")) %>%
add_annotations(
x = 0.5, xref = "paper",
y = 0.9, yref = "paper",
text = "Höger",
showarrow = FALSE,
font = list(color = "#1e2791", size = 14)
) %>%
add_annotations(
x = 0.5, xref = "paper",
y = 0.1, yref = "paper",
text = "Vänster",
showarrow = FALSE,
font = list(color = "#b30000", size = 14)
)
?font
?add_annotation
?add_annotations
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt" ,
År == 2024 ,
Kön = "Båda") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt" ,
År == 2024 ,
Kön == "Båda") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df
View(df)
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt" ,
År == 2024 ,
Kön == "Båda") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df %>%
ggplot(aes(y = Parti, x = Andel, fill = Ålder,
text = paste(Parti, "\nÅlderskategori: ", Ålder, "\nAndel: ", Andel, "%"))) +
geom_col(position = "dodge") +
xlab("Andel, %") +
ss_theme +
scale_fill_manual(values = c("18-29" = "#ffb1b1",
"30-49" = "#64b6ee" ,
"50-64" = "#94c58c",
"65+" = "#ffff9a"))
levels = c("65+" , "50-64" , "30-49" , "18-29")
levels = c("65+" , "50-64" , "30-49" , "18-29")
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt" ,
År == 2024 ,
Kön == "Båda") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df %>%
ggplot(aes(y = Parti, x = Andel, fill = factor(Ålder , level = levels),
text = paste(Parti, "\nÅlderskategori: ", Ålder, "\nAndel: ", Andel, "%"))) +
geom_col(position = "dodge") +
xlab("Andel, %") +
ss_theme +
scale_fill_manual(values = c("18-29" = "#ffb1b1",
"30-49" = "#64b6ee" ,
"50-64" = "#94c58c",
"65+" = "#ffff9a"))
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt" ,
År == 2024 ,
Kön == "Båda") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df %>%
ggplot(aes(y = Parti, x = Andel, fill = factor(Ålder , level = levels),
text = paste(Parti, "\nÅlderskategori: ", Ålder, "\nAndel: ", Andel, "%"))) +
geom_col(position = "dodge") +
xlab("Andel, %") +
labs(fill = "Ålderskategori") +
ss_theme +
scale_fill_manual(values = c("18-29" = "#ffb1b1",
"30-49" = "#64b6ee" ,
"50-64" = "#94c58c",
"65+" = "#ffff9a"))
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt") %>%
pivot_longer(!c(År, Kön, Ålder) , names_to = "Parti" , values_to = "Andel")
df_blå <- df %>%
filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
group_by(År, Ålder) %>%
summarise(Blå = sum(Andel, na.rm = TRUE))
df_röd <- df %>%
filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna",
"Vänsterpartiet", "Centerpartiet")) %>%
group_by(År, Ålder) %>%
summarise(Röd = sum(Andel, na.rm = TRUE))
df_combined <- cbind(df_blå, df_röd)
df_combined <- df_combined %>%
select(-c(5, 6, 7))
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt") %>%
pivot_longer(!c(År, Ålder) , names_to = "Parti" , values_to = "Andel")
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt") %>%
pivot_longer(!c(År, Ålder) , names_to = "Parti" , values_to = "Andel")
df <- partisympati_kön_ålder %>%
filter(Ålder != "Totalt") %>%
pivot_longer(!c(År, Ålder , Kön) , names_to = "Parti" , values_to = "Andel")
partisympati_kön_ålder
df <- partisympati_kön_ålder %>%
select(!Kön) %>%
filter(Ålder != "Totalt") %>%
pivot_longer(!c(År, Ålder) , names_to = "Parti" , values_to = "Andel")
df_blå <- df %>%
filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")) %>%
group_by(År, Ålder) %>%
summarise(Blå = sum(Andel, na.rm = TRUE))
df_röd <- df %>%
filter(Parti %in% c("Miljöpartiet", "Socialdemokraterna",
"Vänsterpartiet", "Centerpartiet")) %>%
group_by(År, Ålder) %>%
summarise(Röd = sum(Andel, na.rm = TRUE))
df_combined <- cbind(df_blå, df_röd)
df_combined
df_combined <- df_combined %>%
select(-c(4, 5))
colnames(df_combined) <- c("År" ,  "Ålder" , "Blå" , "Röd")
df_combined <- df_combined %>%
mutate(Blocktillhörighet = round(Blå / (Blå + Röd) , 2))
df_combined$År <- as.factor(df_combined$År)
df_combined %>%
filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
"2009", "2010", "2011" ,
"2012" , "2013" , "2014" ,
"2015" , "2016" ,"2017")) %>%
ggplot(aes(x = År , y = Blocktillhörighet , group = Ålder , color = Ålder,
text = paste(År, "\nKategori: " , Ålder, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
geom_line(linewidth = 1)
df_combined %>%
filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
"2009", "2010", "2011" ,
"2012" , "2013" , "2014" ,
"2015" , "2016" ,"2017")) %>%
ggplot(aes(x = År , y = Blocktillhörighet , group = Ålder , color = Ålder,
text = paste(År, "\nKategori: " , Ålder, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
geom_line(linewidth = 1) +
scale_y_continuous(limits = c(0.4, 0.6),
breaks = 0.5,
labels = scales::percent_format(accuracy = 1)) +
scale_x_discrete(breaks = c("2018" , "2024")) +
scale_fill_manual(values = c("18-29" = "#ffb1b1",
"30-49" = "#64b6ee" ,
"50-64" = "#94c58c",
"65+" = "#ffff9a")) +
labs(color = "Kategori") +
ss_theme
df_combined %>%
filter(!År %in% c("2006", "2007", "2008",   # Då Centerpartiet var ett högerparti fram till 2018
"2009", "2010", "2011" ,
"2012" , "2013" , "2014" ,
"2015" , "2016" ,"2017")) %>%
ggplot(aes(x = År , y = Blocktillhörighet , group = Ålder , color = Ålder,
text = paste(År, "\nKategori: " , Ålder, "\nAndel höger: " , Blocktillhörighet * 100, "%"))) +
geom_line(linewidth = 1) +
scale_y_continuous(limits = c(0.4, 0.6),
breaks = 0.5,
labels = scales::percent_format(accuracy = 1)) +
scale_x_discrete(breaks = c("2018" , "2024")) +
scale_color_manual(values = c("18-29" = "#ffb1b1",
"30-49" = "#64b6ee" ,
"50-64" = "#94c58c",
"65+" = "#ffff9a"))
partisympati_kön_ålder
partisympati_kön_ålder %>%
filter(Ålder == "Totalt") %>%
filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna") %>%
df <- partisympati_kön_ålder %>%
filter(Ålder == "Totalt") %>%
filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna")
df <- partisympati_kön_ålder %>%
filter(Ålder == "Totalt") %>%
filter(Parti %in% c("Moderaterna", "Liberalerna", "Kristdemokraterna", "Sverigedemokraterna"))
partisympati_kön_ålder %>%
filter(År == "2024" ,
Ålder == "Totalt") -> df
df
partisympati_kön_ålder %>%
filter(År == "2024" ,
Ålder != "Totalt") -> df
partisympati_kön_ålder %>%
filter(År == "2024" ,
Ålder != "Totalt" ,
Kön == "Båda") -> df
